<mxGraphModel dx="1422" dy="744" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="0" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850" background="none" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="d9jSSjegFrbmp7gBr0p--5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="d9jSSjegFrbmp7gBr0p--3" target="d9jSSjegFrbmp7gBr0p--4" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--3" value="提交审批" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="395" y="40" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--9" value="" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="d9jSSjegFrbmp7gBr0p--4" target="d9jSSjegFrbmp7gBr0p--8" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--4" value="生成审批单" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="395" y="160" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--13" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;edgeStyle=orthogonalEdgeStyle;" parent="1" source="d9jSSjegFrbmp7gBr0p--8" target="d9jSSjegFrbmp7gBr0p--12" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="d9jSSjegFrbmp7gBr0p--8" target="d9jSSjegFrbmp7gBr0p--14" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--8" value="循环执行节点" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="395" y="280" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--14" value="结束&lt;br&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="555" y="400" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--19" value="" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=1 4;" parent="1" source="d9jSSjegFrbmp7gBr0p--12" target="d9jSSjegFrbmp7gBr0p--18" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--12" value="下一个审批人" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="395" y="400" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="d9jSSjegFrbmp7gBr0p--18" target="d9jSSjegFrbmp7gBr0p--14" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="d9jSSjegFrbmp7gBr0p--18" target="d9jSSjegFrbmp7gBr0p--8" edge="1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="315" y="530"/><mxPoint x="315" y="300"/></Array></mxGeometry></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--18" value="审批人审批" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="395" y="510" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--7" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="d9jSSjegFrbmp7gBr0p--6" target="d9jSSjegFrbmp7gBr0p--4" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--6" value="生成审批单（摘要）&lt;br&gt;生成审批明细信息&lt;br&gt;生成审批执行节点" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1"><mxGeometry x="635" y="80" width="110" height="80" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--11" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="d9jSSjegFrbmp7gBr0p--10" target="d9jSSjegFrbmp7gBr0p--8" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--10" value="&lt;span&gt;可执行节点类型：&lt;/span&gt;&lt;br&gt;&lt;span&gt;审批节点（停止）&lt;/span&gt;&lt;br&gt;&lt;span&gt;抄送节点（继续）&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1"><mxGeometry x="635" y="200" width="110" height="80" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--17" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;dashed=1;" parent="1" source="d9jSSjegFrbmp7gBr0p--16" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="595" y="340" as="targetPoint"/></mxGeometry></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--16" value="节点执行结束，没有下一个节点" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="755" y="330" width="130" height="50" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--21" value="&amp;nbsp;审批节点执行逻辑：&lt;br&gt;&amp;nbsp;设置当前审批人" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="745" y="190" width="130" height="50" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--22" value="&amp;nbsp;抄送节点执行逻辑：&lt;br&gt;&amp;nbsp;生成抄送人记录&lt;br&gt;&amp;nbsp;通知？是否需要" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="745" y="240" width="130" height="50" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--25" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;dashed=1;" parent="1" source="d9jSSjegFrbmp7gBr0p--24" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="595" y="470" as="targetPoint"/></mxGeometry></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--24" value="驳回" style="text;html=1;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="710" y="490" width="45" height="30" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--28" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;dashed=1;" parent="1" source="d9jSSjegFrbmp7gBr0p--27" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="315" y="480" as="targetPoint"/></mxGeometry></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--27" value="审批通过" style="text;html=1;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="155" y="490" width="65" height="30" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--32" value="提交审批" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry y="1000" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--33" value="&lt;ol&gt;&lt;li&gt;生成审批单信息（审批单基础信息，摘要信息，通知模板摘要信息，明细信息）&lt;/li&gt;&lt;li&gt;根据审批类型的节点配置，预生成审批单的节点信息（审批节点，抄送节点）&lt;/li&gt;&lt;li&gt;从第一个节点开始执行节点逻辑&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;dashed=1;" parent="1" vertex="1"><mxGeometry y="1040" width="520" height="60" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--34" value="审批通过" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry y="1120" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--35" value="提交审批" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="760" y="880" width="80" height="120" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--36" value="审批通过" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="840" y="880" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--37" value="审批驳回" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="840" y="920" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--38" value="撤回审批" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="840" y="960" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--39" value="&lt;ol&gt;&lt;li&gt;生成审批记录，状态为通过&lt;/li&gt;&lt;li&gt;从当前执行的节点，开始执行节点逻辑&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;dashed=1;" parent="1" vertex="1"><mxGeometry y="1160" width="520" height="50" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--41" value="&lt;div&gt;&lt;/div&gt;&lt;br&gt;&amp;nbsp; 执行节点逻辑：从指定的开始节点开始循环执行节点（根据预生成的审批单节点按顺序执行）&lt;br&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;审批节点：1. 设置当前审批人 2. 给审批人发送通知（如果需要） 3. 退出循环&lt;/li&gt;&lt;li&gt;抄送节点：1. 生成抄送记录&amp;nbsp; 2. 给抄送人发送通知（如果需要） 3. 循环继续&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;&amp;nbsp; 循环执行节点之后，需记录当前执行的节点。&lt;/div&gt;&lt;div&gt;&amp;nbsp; 如果所有节点都执行完毕：&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;修改审批单状态为通过&lt;/li&gt;&lt;li&gt;给提交审批的人发送审批单审批通过的通知&lt;/li&gt;&lt;li&gt;通知对应的业务审批单审批通过（业务通过MQ or 事件监听审批通过，执行业务逻辑）&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;dashed=1;" parent="1" vertex="1"><mxGeometry x="560" y="1200" width="520" height="170" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--42" value="审批驳回" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry y="1230" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--43" value="&lt;ol&gt;&lt;li&gt;生成审批记录，状态为驳回&lt;/li&gt;&lt;li&gt;审批单状态修改为驳回&lt;/li&gt;&lt;li&gt;给审批单提交人发送审批单驳回通知&lt;/li&gt;&lt;li&gt;通知对应的业务审批单审批驳回（业务通过MQ or 事件监听审批通过，执行业务逻辑）&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;dashed=1;" parent="1" vertex="1"><mxGeometry y="1270" width="520" height="80" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--44" value="撤回审批" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry y="1375" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--45" value="&lt;ol&gt;&lt;li&gt;修改审批单状态为撤回&lt;/li&gt;&lt;li&gt;通知对应的业务审批单审批已撤回（业务通过MQ or 事件监听审批通过，执行业务逻辑）&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;dashed=1;" parent="1" vertex="1"><mxGeometry y="1415" width="520" height="55" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--46" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;b&gt;ApprovalHandler&lt;/b&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+ submit(String, String, Object): String&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+ pass(String, String): Void&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+ reject(String, String): Void&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+ withdraw(String, String): Void&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;- executeNode(String, String): Void&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;dashed=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="160" y="880" width="240" height="120" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--47" value="执行节点逻辑" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="560" y="1160" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--48" value="&lt;div&gt;&lt;ul&gt;&lt;li&gt;查询出对应审批类型的节点配置信息&lt;/li&gt;&lt;li&gt;从根节点开始生成&lt;/li&gt;&lt;li&gt;如果是审批节点或抄送节点，则直接生成节点记录信息，并记录顺序&lt;/li&gt;&lt;li&gt;如果是条件节点，需要根据提交的审批内容计算下一个节点&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;dashed=1;" parent="1" vertex="1"><mxGeometry x="560" y="1040" width="520" height="80" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--49" value="节点预生成" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="560" y="1000" width="80" height="40" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--51" value="事件" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="480" y="1460" width="40" height="20" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--52" value="事件" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="480" y="1340" width="40" height="20" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--53" value="事件" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="1040" y="1300" width="40" height="20" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--57" value="条件节点计算" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;" parent="1" vertex="1"><mxGeometry x="1000" y="1100" width="80" height="20" as="geometry"/></mxCell><mxCell id="d9jSSjegFrbmp7gBr0p--58" value="&lt;font color=&quot;#97d077&quot;&gt;&lt;br&gt;&amp;nbsp; 通知模板标题：&lt;br&gt;&lt;ul&gt;&lt;li&gt;&lt;span style=&quot;color: rgb(151 , 208 , 119)&quot;&gt;审批人通知： ${submitter}提交的${approvalType}&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span style=&quot;color: rgb(151 , 208 , 119)&quot;&gt;催办通知：${submitter}提醒你尽快审批${approvalType}&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span style=&quot;color: rgb(151 , 208 , 119)&quot;&gt;抄送通知：${submitter}提交的${approvalType}抄送给你，请知晓&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span style=&quot;color: rgb(151 , 208 , 119)&quot;&gt;审批通过通知：你提交的${approvalType}已通过&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span style=&quot;color: rgb(151 , 208 , 119)&quot;&gt;审批驳回通知：你提交的${approvalType}已驳回&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/font&gt;&lt;div&gt;&lt;/div&gt;" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;strokeColor=#97D077;" parent="1" vertex="1"><mxGeometry x="675" y="1415" width="405" height="120" as="geometry"/></mxCell><mxCell id="LU_r6GYVHZwaLgve0JwT-1" value="&lt;div&gt;&amp;nbsp; 确保MQ消息能准确消费：&lt;/div&gt;&lt;div&gt;&amp;nbsp; MQ消息不丢失&lt;/div&gt;&lt;div&gt;&amp;nbsp; MQ消息消费者消费失败的情况下，记录数据库，定时任务或手动重新执行&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=#000000;dashed=1;" vertex="1" parent="1"><mxGeometry y="1520" width="520" height="55" as="geometry"/></mxCell></root></mxGraphModel>